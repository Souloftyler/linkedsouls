<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>LINKED SOULS - √âchos des T√©n√®bres</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Lora:ital,wght@0,400;0,700;1,400&family=Lato:wght@400;700&display=swap');

        :root {
            --ethereal-blue: #3b82f6;
            --gold: #fbbf24;
            --blood: #991b1b;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #0c0a09;
        }

        body {
            font-family: 'Lato', sans-serif;
            color: #d6d3d1;
            display: flex;
            flex-direction: column;
        }
        
        h1, h2, .fantasy-font { font-family: 'Cinzel', serif; }
        .story-text { 
            font-family: 'Lora', serif; 
            line-height: 1.5;
        }

        /* Limitation √† 5 lignes max pour la description */
        .story-text-clamped {
            display: -webkit-box;
            -webkit-line-clamp: 5;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        main {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .tab-content { 
            display: none; 
            flex: 1;
            overflow-y: auto; 
            -webkit-overflow-scrolling: touch;
            padding: 1rem;
            touch-action: pan-y;
        }
        .tab-content.active { display: flex; flex-direction: column; }

        .story-container {
            background: rgba(28, 25, 23, 0.6);
            border: 1px solid rgba(68, 64, 60, 0.4);
            border-radius: 1rem;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-shrink: 0;
        }

        .action-btn {
            background: rgba(12, 10, 9, 0.4);
            border-top: 1px solid rgba(68, 64, 60, 0.2);
            transition: all 0.2s ease;
            text-align: left;
            width: 100%;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        .action-btn:active { background: rgba(59, 130, 246, 0.1); color: var(--ethereal-blue); }
        .action-btn.disabled { opacity: 0.3; pointer-events: none; }

        .equipment-slot {
            background: rgba(28, 25, 23, 0.8);
            border: 1px solid rgba(68, 64, 60, 0.5);
            border-radius: 0.5rem;
        }
        .equipment-slot.active { border-color: var(--ethereal-blue); }

        ::-webkit-scrollbar { width: 3px; }
        ::-webkit-scrollbar-thumb { background: #44403c; }
    </style>
</head>
<body class="bg-stone-950">

    <header class="flex-none bg-stone-900/95 border-b border-stone-800 p-3 flex justify-between items-center z-20 backdrop-blur-md">
        <div class="flex items-center space-x-3">
            <div class="relative w-10 h-10">
                <canvas id="healthMiniChart"></canvas>
                <div class="absolute inset-0 flex items-center justify-center">
                    <span class="text-[9px] font-bold text-red-500" id="hpValue">100</span>
                </div>
            </div>
            <div>
                <h1 class="text-stone-100 text-[8px] font-bold uppercase tracking-widest">√Çme Li√©e</h1>
                <div class="flex space-x-2 mt-0.5">
                    <span class="text-[8px] text-blue-400 font-bold">‚öîÔ∏è <span id="header-stat-atk">0</span></span>
                    <span class="text-[8px] text-red-400 font-bold">üõ°Ô∏è <span id="header-stat-def">0</span></span>
                </div>
            </div>
        </div>
        <div class="text-right">
            <div class="flex items-center justify-end space-x-1 text-amber-500">
                <span class="text-xs font-bold" id="goldValue">50</span>
                <span class="text-[10px]">ü™ô</span>
            </div>
            <div class="w-12 bg-stone-800 h-1 rounded-full mt-1 ml-auto overflow-hidden">
                <div id="fatigueProgress" class="h-full bg-purple-600 transition-all" style="width: 0%"></div>
            </div>
        </div>
    </header>

    <main>
        <div id="tab-story" class="tab-content active">
            <div class="flex justify-between items-center mb-3">
                <span id="currentLocationTitle" class="text-[9px] text-stone-500 uppercase font-bold tracking-[0.2em]">Chargement...</span>
                <span id="fatigueText" class="text-[7px] text-stone-600 uppercase font-bold">Fatigue 0%</span>
            </div>
            
            <div class="grid grid-cols-3 gap-2 mb-3 flex-none">
                <div class="equipment-slot p-2 flex flex-col items-center" id="ui-slot-rightHand">
                    <span class="text-[12px]" id="icon-rightHand">‚öîÔ∏è</span>
                    <p class="text-[7px] text-stone-400 mt-1 truncate w-full text-center font-bold uppercase" id="name-rightHand">Main D.</p>
                </div>
                <div class="equipment-slot p-2 flex flex-col items-center" id="ui-slot-leftHand">
                    <span class="text-[12px]" id="icon-leftHand">üõ°Ô∏è</span>
                    <p class="text-[7px] text-stone-400 mt-1 truncate w-full text-center font-bold uppercase" id="name-leftHand">Main G.</p>
                </div>
                <div class="equipment-slot p-2 flex flex-col items-center" id="ui-slot-armor">
                    <span class="text-[12px]" id="icon-armor">üëï</span>
                    <p class="text-[7px] text-stone-400 mt-1 truncate w-full text-center font-bold uppercase" id="name-armor">Corps</p>
                </div>
            </div>

            <div id="itemNotificationArea" class="mb-2 space-y-1"></div>
            
            <div class="story-container">
                <div id="storyLog" class="p-4 story-text story-text-clamped text-stone-300 text-xs italic">
                    <!-- Texte limit√© √† 5 lignes -->
                </div>
                
                <div id="actionPanel" class="bg-stone-900/30">
                    <!-- Boutons ici -->
                </div>
            </div>
            
            <div class="h-6 flex-none"></div>
        </div>

        <div id="tab-inventory" class="tab-content">
            <h2 class="text-stone-500 text-[10px] font-bold uppercase mb-4 tracking-widest border-b border-stone-800 pb-2">Inventaire</h2>
            <div id="inventoryList" class="space-y-2"></div>
        </div>

        <div id="tab-journal" class="tab-content">
            <h2 class="text-stone-500 text-[10px] font-bold uppercase mb-4 tracking-widest border-b border-stone-800 pb-2">Notes</h2>
            <div id="journalList" class="space-y-2"></div>
        </div>
    </main>

    <nav class="flex-none bg-stone-900 border-t border-stone-800 flex justify-around items-center py-2 pb-4 z-30">
        <button onclick="switchTab('story')" class="nav-item flex flex-col items-center text-blue-500" id="nav-story">
            <span class="text-xl">üß≠</span>
            <span class="text-[8px] font-bold uppercase mt-1">Monde</span>
        </button>
        <button onclick="switchTab('inventory')" class="nav-item flex flex-col items-center text-stone-600" id="nav-inventory">
            <span class="text-xl">üéí</span>
            <span class="text-[8px] font-bold uppercase mt-1">Sac</span>
        </button>
        <button onclick="switchTab('journal')" class="nav-item flex flex-col items-center text-stone-600" id="nav-journal">
            <span class="text-xl">üìú</span>
            <span class="text-[8px] font-bold uppercase mt-1">Notes</span>
        </button>
    </nav>

    <script>
        let state = {
            hp: 100, gold: 50, fatigue: 0,
            equipment: { rightHand: null, leftHand: null, armor: null },
            inventory: [
                { id: 'fiole_rouge', name: "Fiole de Sang", icon: "üß™", type: "consumable", count: 2, heal: 30, desc: "Soin l√©ger." }
            ],
            notes: ["R√©veil sur les quais de Port-Sable."],
            currentStep: 'port_entry'
        };

        const storyData = {
            port_entry: {
                title: "Quais de Port-Sable",
                text: "La brume est si √©paisse qu'on ne distingue plus l'horizon. L'odeur de sel se m√™le √† celle de la charogne. Devant vous, un vieux p√™cheur nomm√© Elias semble surveiller les eaux sombres. Au loin, les lumi√®res du March√© Noir scintillent comme des yeux de pr√©dateurs affam√©s. C'est ici que tout commence pour vous, au milieu des d√©bris d'un monde qui refuse de mourir.",
                actions: [
                    { label: "Parler √† Elias", next: 'elias_talk', icon: "üë§" },
                    { label: "Le March√© Noir", next: 'market', icon: "üè∫" },
                    { label: "Route du Sud", next: 'south', icon: "ü•æ", fatigue: 10 }
                ]
            },
            elias_talk: {
                title: "Conseils d'Elias",
                text: "¬´ Ne regarde pas trop longtemps dans l'eau, √©tranger. Ce qui y vit n'aime pas √™tre observ√© par les vivants. Prends garde √† ta fatigue, elle est plus meurtri√®re que n'importe quelle lame forg√©e. La faim et le sommeil sont tes pires ennemis dans cette contr√©e oubli√©e des dieux. ¬ª",
                actions: [
                    { label: "Partir", next: 'port_entry', icon: "‚Ü©Ô∏è" }
                ]
            },
            market: {
                title: "Le March√© Noir",
                text: "Un d√©dale d'√©tals miteux o√π l'on vend tout ce qui est interdit par la loi et la morale. L'acier ici est cher, mais c'est la seule protection fiable contre les ombres. Des marchands borgnes vous observent en silence.",
                actions: [
                    { label: "Acheter Dague (30g)", next: 'buy_bone', cost: 30, icon: "ü¶¥" },
                    { label: "Quitter", next: 'port_entry', icon: "‚Ü©Ô∏è" }
                ]
            },
            buy_bone: {
                title: "Nouvelle Arme",
                text: "Une dague sculpt√©e dans un f√©mur de cr√©ature inconnue. Elle vibre l√©g√®rement dans votre main, comme si elle r√©clamait son d√ª. C'est un outil de mort efficace, bien que rudimentaire.",
                actions: [{ label: "Continuer", next: 'market', icon: "üß≠" }],
                onEnter: () => addItem({ id: 'bone_dagger', name: "Dague Os", icon: "üó°Ô∏è", type: "weapon", value: 12, desc: "L√©g√®re et maudite." })
            },
            south: {
                title: "Route du Sud",
                text: "La route est longue et d√©sol√©e. Les herbes s√®ches sifflent sous le vent mauvais. La fatigue commence √† peser lourdement sur vos √©paules alors que vous progressez p√©niblement vers l'inconnu.",
                actions: [{ label: "Revenir", next: 'port_entry', icon: "‚Ü©Ô∏è" }]
            }
        };

        let healthChart = null;

        function updateUI() {
            document.getElementById('hpValue').innerText = Math.max(0, state.hp);
            document.getElementById('goldValue').innerText = state.gold;
            document.getElementById('header-stat-atk').innerText = state.equipment.rightHand?.value || 0;
            document.getElementById('header-stat-def').innerText = (state.equipment.leftHand?.value || 0) + (state.equipment.armor?.value || 0);
            document.getElementById('fatigueProgress').style.width = state.fatigue + "%";
            document.getElementById('fatigueText').innerText = `Fatigue ${state.fatigue}%`;

            ['rightHand', 'leftHand', 'armor'].forEach(slot => {
                const item = state.equipment[slot];
                document.getElementById('name-' + slot).innerText = item ? item.name : 'Vide';
                document.getElementById('icon-' + slot).innerText = item ? item.icon : (slot==='armor'?'üëï':slot==='leftHand'?'üõ°Ô∏è':'‚öîÔ∏è');
                document.getElementById('ui-slot-' + slot).classList.toggle('active', !!item);
            });

            if (healthChart) {
                healthChart.data.datasets[0].data = [state.hp, 100 - state.hp];
                healthChart.update();
            }
        }

        function renderStep(stepId) {
            const step = storyData[stepId];
            if (!step) return;
            state.currentStep = stepId;
            if (step.onEnter) step.onEnter();

            document.getElementById('currentLocationTitle').innerText = step.title;
            document.getElementById('storyLog').innerHTML = step.text;

            const panel = document.getElementById('actionPanel');
            panel.innerHTML = '';
            step.actions.forEach(act => {
                const canAfford = !act.cost || state.gold >= act.cost;
                const btn = document.createElement('button');
                btn.className = `action-btn ${!canAfford ? 'disabled' : ''}`;
                btn.innerHTML = `<span>${act.icon} ${act.label} ${act.cost ? `(${act.cost}g)` : ''}</span> <span>‚ùØ</span>`;
                btn.onclick = () => {
                    if (act.cost) state.gold -= act.cost;
                    if (act.fatigue) state.fatigue = Math.min(100, state.fatigue + act.fatigue);
                    renderStep(act.next);
                };
                panel.appendChild(btn);
            });
            updateUI();
        }

        function addItem(item) {
            const existing = state.inventory.find(i => i.id === item.id);
            if (existing) existing.count++;
            else state.inventory.push({ ...item });
            showNotification(`+ ${item.name}`);
            updateUI();
        }

        function useItem(itemId) {
            const index = state.inventory.findIndex(i => i.id === itemId);
            const item = state.inventory[index];
            if (['weapon', 'armor', 'offhand'].includes(item.type)) {
                let slot = item.type === 'weapon' ? 'rightHand' : (item.type === 'armor' ? 'armor' : 'leftHand');
                state.equipment[slot] = (state.equipment[slot]?.id === item.id) ? null : item;
            } else {
                if (item.heal) state.hp = Math.min(100, state.hp + item.heal);
                item.count--;
                if (item.count <= 0) state.inventory.splice(index, 1);
            }
            updateUI();
            updateInventoryUI();
        }

        function updateInventoryUI() {
            const list = document.getElementById('inventoryList');
            list.innerHTML = state.inventory.map(item => {
                const isEq = Object.values(state.equipment).some(e => e?.id === item.id);
                return `
                    <div onclick="useItem('${item.id}')" class="p-3 bg-stone-900 rounded-lg flex items-center justify-between border ${isEq ? 'border-blue-500 bg-blue-900/10' : 'border-stone-800'}">
                        <div class="flex items-center gap-3">
                            <span class="text-xl">${item.icon}</span>
                            <div>
                                <h3 class="text-[9px] font-bold text-stone-100 uppercase">${item.name} ${item.count > 1 ? `x${item.count}` : ''}</h3>
                                <p class="text-[7px] text-stone-500 italic">${item.desc}</p>
                            </div>
                        </div>
                        ${isEq ? '<span class="text-[7px] text-blue-400 font-bold uppercase">√âquip√©</span>' : ''}
                    </div>`;
            }).join('');
        }

        function showNotification(msg) {
            const area = document.getElementById('itemNotificationArea');
            const el = document.createElement('div');
            el.className = "p-2 bg-blue-900/30 text-blue-300 border-l-2 border-blue-500 text-[8px] font-bold uppercase tracking-widest";
            el.innerText = msg;
            area.appendChild(el);
            setTimeout(() => el.remove(), 2000);
        }

        function switchTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.replace('text-blue-500', 'text-stone-600'));
            document.getElementById('tab-' + id).classList.add('active');
            document.getElementById('nav-' + id).classList.replace('text-stone-600', 'text-blue-500');
            if(id === 'inventory') updateInventoryUI();
        }

        window.onload = () => {
            const ctx = document.getElementById('healthMiniChart').getContext('2d');
            healthChart = new Chart(ctx, { 
                type: 'doughnut', 
                data: { datasets: [{ data: [100, 0], backgroundColor: ['#991b1b', '#1c1917'], borderWidth: 0 }] }, 
                options: { cutout: '80%', plugins: { legend: { display: false }, tooltip: { enabled: false } } } 
            });
            renderStep(state.currentStep);
        };
    </script>
</body>
</html>
